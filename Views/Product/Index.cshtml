@model IEnumerable<AnanasClone.ViewModels.ProductViewModel>

@{
    ViewData["Title"] = "Sản phẩm";
    var selectedCategory = ViewBag.SelectedCategory as string;
    var selectedStatus = ViewBag.SelectedStatus as string;
    var selectedStyle = ViewBag.SelectedStyle as string;
    var selectedLine = ViewBag.SelectedLine as string;
    var selectedPriceMin = ViewBag.SelectedPriceMin as decimal?;
    var selectedPriceMax = ViewBag.SelectedPriceMax as decimal?;
}

<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar Filter -->
        <aside class="col-lg-3 mb-4">
            <form method="get" id="filterForm">
                <div class="card shadow-sm border-0 mb-3">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">Danh mục</h5>
                        <select name="category" class="form-select mb-3" onchange="this.form.submit()">
                            <option value="">Tất cả</option>
                            @foreach (var cat in (List<string>)ViewBag.Categories)
                            {
                                if (selectedCategory == cat)
                                {
                                    <option value="@cat" selected>@cat</option>
                                }
                                else
                                {
                                    <option value="@cat">@cat</option>
                                }
                            }
                        </select>
                        <h6 class="fw-bold mt-4">Trạng thái</h6>
                        <select name="status" class="form-select mb-3" onchange="this.form.submit()">
                            <option value="">Tất cả</option>
                            @foreach (var st in (List<string>)ViewBag.Statuses)
                            {
                                if (selectedStatus == st)
                                {
                                    <option value="@st" selected>@st</option>
                                }
                                else
                                {
                                    <option value="@st">@st</option>
                                }
                            }
                        </select>
                        <h6 class="fw-bold mt-4">Kiểu dáng</h6>
                        <select name="style" class="form-select mb-3" onchange="this.form.submit()">
                            <option value="">Tất cả</option>
                            @foreach (var st in (List<string>)ViewBag.Styles)
                            {
                                if (selectedStyle == st)
                                {
                                    <option value="@st" selected>@st</option>
                                }
                                else
                                {
                                    <option value="@st">@st</option>
                                }
                            }
                        </select>
                        <h6 class="fw-bold mt-4">Dòng sản phẩm</h6>
                        <select name="line" class="form-select mb-3" onchange="this.form.submit()">
                            <option value="">Tất cả</option>
                            @foreach (var ln in (List<string>)ViewBag.Lines)
                            {
                                if (selectedLine == ln)
                                {
                                    <option value="@ln" selected>@ln</option>
                                }
                                else
                                {
                                    <option value="@ln">@ln</option>
                                }
                            }
                        </select>
                        <h6 class="fw-bold mt-4">Giá</h6>
                        <div class="row g-2 mb-2">
                            <div class="col-6">
                                <input type="number" name="priceMin" class="form-control" placeholder="Từ" min="0" value="@(selectedPriceMin?.ToString() ?? "")" onchange="this.form.submit()" />
                            </div>
                            <div class="col-6">
                                <input type="number" name="priceMax" class="form-control" placeholder="Đến" min="0" value="@(selectedPriceMax?.ToString() ?? "")" onchange="this.form.submit()" />
                            </div>
                        </div>
                        <button type="submit" class="btn btn-warning w-100 mt-2">Lọc</button>
                    </div>
                </div>
            </form>
        </aside>
        <!-- Product Grid -->
        <section class="col-lg-9">
            <h2 class="fw-bold mb-4">Tất cả sản phẩm</h2>
            <div class="row g-4">
                @foreach (var product in Model)
                {
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                        <div class="card h-100 border-0 shadow-sm product-card position-relative">
                            <div class="position-relative">
                                <a asp-action="Details" asp-route-id="@product.Id">
                                    <img src="@product.ImageUrl" class="card-img-top rounded-top" alt="@product.Name" style="height:200px; object-fit:cover;">
                                </a>
                                @if (product.DiscountPercentage > 0)
                                {
                                    <span class="badge bg-danger position-absolute top-0 start-0 m-2">Sale</span>
                                }
                                @* Ví dụ: New, Limited, Hết hàng *@
                                @if (product.StockQuantity == 0)
                                {
                                    <span class="badge bg-secondary position-absolute top-0 end-0 m-2">Hết hàng</span>
                                }
                            </div>
                            <div class="card-body text-center">
                                <a asp-action="Details" asp-route-id="@product.Id" class="text-decoration-none text-dark">
                                    <h6 class="card-title fw-bold">@product.Name</h6>
                                </a>
                                <p class="card-text text-danger mb-1 fs-6">@product.DiscountedPrice.ToString("N0") đ</p>
                                @if (product.DiscountPercentage > 0)
                                {
                                    <span class="text-decoration-line-through text-muted small">@product.Price.ToString("N0") đ</span>
                                }
                                <div class="mt-2">
                                    <a asp-action="Details" asp-route-id="@product.Id" class="btn btn-outline-warning btn-sm w-100">Xem chi tiết <i class="bi bi-eye"></i></a>
                                    <form asp-controller="Cart" asp-action="AddToCart" method="post" class="mt-2">
                                        <input type="hidden" name="productId" value="@product.Id" />
                                        <input type="number" name="quantity" value="1" min="1" class="form-control form-control-sm d-inline-block w-auto me-2" style="width:60px;" />
                                        <button type="submit" class="btn btn-success btn-sm">Thêm vào giỏ <i class="bi bi-cart-plus"></i></button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </section>
    </div>
</div>
@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
} 